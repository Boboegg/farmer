<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é€€ä¼‘è©¦ç®— - å°Šåš´è¾²æ¥­</title>
    
    <!-- 1. å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. å¼•å…¥ React å’Œ ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    
    <!-- 3. å¼•å…¥ Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- 4. å¼•å…¥ Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- 5. [é—œéµä¿®æ­£] å¼•å…¥ Prop-types (åœ–è¡¨å·¥å…·å¿…éœ€) -->
    <script src="https://unpkg.com/prop-types/prop-types.min.js"></script>
    
    <!-- 5.1 [æ–°å¢] å¼•å…¥ React Is (Recharts ä¾è³´) -->
    <script src="https://unpkg.com/react-is@18/umd/react-is.production.min.js"></script>

    <!-- 6. å¼•å…¥ Recharts (åœ–è¡¨åº«) - æ›´æ–°è‡³ 2.12.7 ä»¥ç¢ºä¿ UMD æ”¯æ´ -->
    <script src="https://unpkg.com/recharts@2.12.7/umd/Recharts.min.js"></script>

    <style>
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        @keyframes fade-in { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fade-in 0.5s ease-out forwards; }
        @keyframes bounce-slow { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        .animate-bounce-slow { animation: bounce-slow 3s infinite; }
        
        /* è©¦ç®—æ©Ÿå°ˆç”¨æ¨£å¼ */
        .label-text { display: block; font-size: 0.75rem; font-weight: 600; color: #64748b; margin-bottom: 0.25rem; }
        .input-field { width: 100%; padding: 0.5rem; border: 1px solid #cbd5e1; border-radius: 0.5rem; font-size: 0.875rem; outline: none; transition: all 0.2s; }
        .input-field:focus { border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); }
    </style>
</head>
<body class="bg-slate-50">
    
    <div id="root"></div>

    <script type="text/babel">
        // --- é˜²ç•¶æ©Ÿæ©Ÿåˆ¶ (å¦‚æœåœ–è¡¨è¼‰å…¥å¤±æ•—ï¼Œé¿å…å…¨ç™½) ---
        const RechartsObj = window.Recharts || {};
        const { 
            BarChart = (props) => <div className="p-4 text-red-500 bg-red-50 rounded">åœ–è¡¨æ¨¡çµ„è¼‰å…¥ä¸­æˆ–å¤±æ•—</div>, 
            Bar = () => null, 
            XAxis = () => null, 
            YAxis = () => null, 
            CartesianGrid = () => null, 
            Tooltip = () => null, 
            Legend = () => null, 
            ResponsiveContainer = ({children}) => <div className="w-full h-64 bg-slate-100 flex items-center justify-center">{children}</div> 
        } = RechartsObj;

        const { useState, useEffect } = React;

        // --- åœ–ç¤ºè™•ç† ---
        const createLucideComponent = (name) => ({ size = 24, className = "", ...props }) => {
            const icon = lucide.icons[name];
            if (!icon) return <span className="text-xs">?</span>;
            return (
                <svg {...icon.attrs} width={size} height={size} className={className} {...props}>
                    {icon.children && icon.children.map(([tag, attrs], index) => {
                        const Tag = tag;
                        return <Tag key={index} {...attrs} />;
                    })}
                </svg>
            );
        };

        const iconList = [
            'Shield', 'Sun', 'AlertTriangle', 'Activity', 'Sprout', 
            'Users', 'BookOpen', 'Phone', 'Download', 'ChevronDown', 
            'ChevronUp', 'Menu', 'X', 'ArrowRight', 'Heart', 'DollarSign',
            'Tractor', 'HelpCircle', 'Video', 'MessageCircle', 'PlayCircle', 
            'Calendar', 'Hammer', 'MapPin', 'ThumbsUp', 'Share2', 'Search',
            'Wind', 'Droplets', 'Mic', 'Globe', 'Clock',
            'Calculator', 'TrendingUp', 'Briefcase', 'ArrowRightLeft', 'Info', 
            'AlertCircle', 'ExternalLink', 'Settings', 'PiggyBank', 'Coins'
        ];

        const Icons = {};
        iconList.forEach(name => { Icons[name] = createLucideComponent(name); });
        
        const { 
            Shield, Sun, AlertTriangle, Activity, Sprout, 
            Users, BookOpen, Phone, Download, ChevronDown, 
            ChevronUp, Menu, X, ArrowRight, Heart, DollarSign,
            Tractor, HelpCircle, Video, MessageCircle, PlayCircle, 
            Calendar, Hammer, MapPin, ThumbsUp, Share2, Search,
            Wind, Droplets, Mic, Globe, Clock,
            Calculator, TrendingUp, Briefcase, ArrowRightLeft, Info, 
            AlertCircle, ExternalLink, Settings, PiggyBank, Coins
        } = Icons;

        // --- èªè¨€è¨­å®š ---
        const translations = {
            zh: {
                title: "å°Šåš´è¾²æ¥­",
                subtitle: "çŸ¥è­˜ä¸­å¿ƒ",
                heroDesc: "é€£çµæ”¿åºœè³‡æºã€é†«ç™‚å°ˆæ¥­èˆ‡åœ¨åœ°ç¶“é©—ï¼Œè®“è¾²æ¥­æˆç‚ºä¸€ä»½æœ‰å°Šåš´ã€å¯æ°¸çºŒçš„å¿—æ¥­ã€‚",
                todayRisk: "ä»Šæ—¥ç†±å±å®³é¢¨éšª",
                high: "é«˜å±éšª",
                nav: {
                    home: "é¦–é ",
                    start: "å¾äº‹è¾²æ¥­",
                    greenhouse: "æº«å®¤æ©Ÿå…·",
                    safety: "æ€¥æ•‘ç´…ç‰Œ",
                    health: "å¥åº·ä¿ƒé€²",
                    insurance: "ä¿éšªç¶“æ¿Ÿ",
                    calculator: "é€€ä¼‘è©¦ç®—",
                    forum: "äº¤æµåœ’åœ°",
                    video: "å½±éŸ³å­¸ç¿’",
                    resources: "è³‡æºä¸‹è¼‰"
                },
                identity: {
                    new: "æˆ‘æƒ³å‹™è¾² (æ–°æ‰‹)",
                    young: "æˆ‘æ˜¯é’è¾² / åœ¨è·",
                    senior: "æˆ‘æ˜¯è³‡æ·±è¾²å‹",
                    enter: "é€²å…¥å°ˆå€"
                },
                section: {
                    forum: "æœ€æ–°äº¤æµå‹•æ…‹",
                    video: "ç†±é–€å½±éŸ³æ¨è–¦",
                    more: "æŸ¥çœ‹æ›´å¤š"
                },
                redCard: {
                    heatTitle: "ç´…ç‰Œ 1ï¼šç†±åˆ°å—ä¸äº† (ä¸­æš‘)",
                    pestTitle: "ç´…ç‰Œ 2ï¼šè¾²è—¥ä¸­æ¯’",
                    heatSub: "æ³¨æ„ï¼æµä¸å‡ºæ±—æ˜¯æœ€å±éšªçš„è¨Šè™Ÿ",
                    pestSub: "åˆ¥ç¡¬æ’ï¼é€™æœƒå‚·åˆ°ç¥ç¶“"
                }
            },
            en: {
                title: "Dignified Agri",
                subtitle: "Knowledge Hub",
                heroDesc: "Connecting resources, medical expertise, and local experience for sustainable agriculture.",
                todayRisk: "Today's Heat Risk",
                high: "High",
                nav: {
                    home: "Home",
                    start: "Start Farming",
                    greenhouse: "Greenhouse",
                    safety: "Emergency SOS",
                    health: "Health Promo",
                    insurance: "Insurance",
                    calculator: "Calculator",
                    forum: "Community",
                    video: "Videos",
                    resources: "Downloads"
                },
                identity: {
                    new: "New Farmer",
                    young: "Professional",
                    senior: "Senior Farmer",
                    enter: "Enter"
                },
                section: {
                    forum: "Latest Discussions",
                    video: "Featured Videos",
                    more: "View More"
                },
                redCard: {
                    heatTitle: "Red Card 1: Heat Stroke",
                    pestTitle: "Red Card 2: Pesticide Poisoning",
                    heatSub: "Warning! No sweating is a danger sign.",
                    pestSub: "Don't endure it! Seek help immediately."
                }
            },
            id: {
                title: "Pertanian Bermartabat",
                subtitle: "Pusat Pengetahuan",
                heroDesc: "Menghubungkan sumber daya pemerintah dan medis untuk pertanian berkelanjutan.",
                todayRisk: "Risiko Panas Hari Ini",
                high: "Tinggi",
                nav: {
                    home: "Beranda",
                    start: "Mulai Bertani",
                    greenhouse: "Rumah Kaca",
                    safety: "SOS Darurat",
                    health: "Kesehatan",
                    insurance: "Asuransi",
                    calculator: "Kalkulator",
                    forum: "Komunitas",
                    video: "Video",
                    resources: "Unduhan"
                },
                identity: {
                    new: "Petani Baru",
                    young: "Profesional",
                    senior: "Petani Senior",
                    enter: "Masuk"
                },
                section: {
                    forum: "Diskusi Terbaru",
                    video: "Video Pilihan",
                    more: "Lihat Lebih"
                },
                redCard: {
                    heatTitle: "Kartu Merah 1: Sengatan Panas",
                    pestTitle: "Kartu Merah 2: Keracunan Pestisida",
                    heatSub: "Peringatan! Tidak berkeringat adalah tanda bahaya.",
                    pestSub: "Segera cari pertolongan medis!"
                }
            }
        };

        // --- 2. è³‡æ–™åº« (ä¿ç•™æ‚¨çš„ä¿®æ”¹ï¼šåœ–ç‰‡èˆ‡é€£çµ) ---
        const videoData = [
          { 
            id: 1, 
            title: "EP1: é‚£äº›å¹´ï¼Œæˆ‘å€‘ä¸€èµ·è¿½çš„é³³æ¢¨", 
            youtubeId: "bL80n414nq0", 
            type: "Podcast", 
            views: "1.2k", 
            date: "2å¤©å‰", 
            desc: "è«‡é³³æ¢¨è¾²æ¡æ”¶çš„è¾›é…¸ï¼Œèˆ‡è…°ç—›çš„å…±è™•ä¹‹é“ã€‚",
            coverColor: "bg-purple-600"
          },
          { 
            id: 2, 
            title: "3åˆ†é˜ç”°é–“ä¼¸å±•æ“ï¼šè²“ç‰›å¼", 
            youtubeId: "nGFe2xwdTB8", 
            type: "Video", 
            views: "3.5k", 
            date: "1é€±å‰", 
            desc: "å°å¤§ç‰©ç†æ²»ç™‚å¸«è¦ªè‡ªç¤ºç¯„ï¼Œèˆ’ç·©ä¸‹èƒŒç—›ã€‚",
            coverColor: "bg-red-500"
          },
          { 
            id: 3, 
            title: "è¾²è—¥é˜²è­·è¡£ç©¿è„« SOP æ•™å­¸", 
            youtubeId: "a6uXnmb_BP0", 
            type: "Video", 
            views: "2.1k", 
            date: "3é€±å‰", 
            desc: "å…ˆè„«æ‰‹å¥—é‚„æ˜¯å…ˆè„«è¡£æœï¼ŸåšéŒ¯æ­¥é©Ÿæ›´å±éšªï¼", 
            coverColor: "bg-red-500" 
          },
        ];

        const safetyData = {
            heat: {
                level: "High Risk",
                symptoms: [
                    { text: "é ­æšˆã€æƒ³åã€é ­å¾ˆç—›", icon: "ğŸ˜µ" },
                    { text: "çš®è†šä¹¾ä¹¾ç‡™ç‡™ (æ²’æµæ±—)", icon: "ğŸ”¥" },
                    { text: "èªªè©±ä¸æ¸…æ¥šã€æ˜å€’", icon: "ğŸ’¤" }
                ],
                actions: [
                    { step: "1. æ‰¾é™°æ¶¼", desc: "è¶•å¿«å»æ¨¹ä¸‹æˆ–é™°å½±è™•", icon: <Wind size={20}/> },
                    { step: "2. è„«è¡£æœ", desc: "è¡£æœé¬†é–‹ã€çš®å¸¶è§£é–‹", icon: <Users size={20}/> },
                    { step: "3. æ½‘å†·æ°´", desc: "èº«é«”æ½‘æ°´é™æº«", icon: <Droplets size={20}/> },
                    { step: "4. æ‰“119", desc: "äººæ˜å€’äº†ç«‹åˆ»å«æ•‘è­·è»Š", icon: <Phone size={20}/> }
                ]
            },
            pesticide: {
                level: "Critical",
                symptoms: [
                    { text: "ç³å­”ç¸®åˆ°å¾ˆå°", icon: "ğŸ‘€" },
                    { text: "ä¸€ç›´æµå£æ°´ã€æµçœ¼æ·š", icon: "ğŸ’¦" },
                    { text: "æ‰‹è…³ä¸€ç›´æŠ–ã€å¸ä¸åˆ°æ°£", icon: "ğŸ’ª" }
                ],
                actions: [
                    { step: "ç¦å‚¬å", desc: "åƒè¬ä¸è¦å‚¬åï¼æœƒç¼å‚·", icon: <X size={20}/> },
                    { step: "æ²–ä¹¾æ·¨", desc: "è„«æ‰é«’è¡£æœï¼Œæ²–æ°´æ´—æ¾¡", icon: <Droplets size={20}/> },
                    { step: "å¸¶ç“¶å­", desc: "æŠŠè¾²è—¥ç“¶å­å¸¶è‘—çµ¦é†«ç”Ÿçœ‹", icon: <BookOpen size={20}/> },
                    { step: "å¿«é€é†«", desc: "æ‰“119 æˆ– æ¯’ç‰©ä¸­å¿ƒ", icon: <Phone size={20}/> }
                ]
            }
        };

        const qaData = [
            { category: "ä¿éšªè¿·æ€", q: "æˆ‘æœ‰è¾²ä¿äº†ï¼Œé‚„éœ€è¦å¥ä¿å—ï¼Ÿ", a: "è¦ï¼å¥ä¿æ˜¯çœ‹é†«ç”Ÿç”¨çš„ï¼Œè¾²ä¿æ˜¯è·æ¥­èº«åˆ†ä¿éšªã€‚å¼·çƒˆå»ºè­°åŠ ä¿ã€Œè¾²æ°‘è·ç½ä¿éšªã€ï¼ŒCP å€¼æ¥µé«˜ï¼Œä¸€å€‹æœˆåªè¦å¹¾åå¡Šï¼Œå—å‚·æœ‰ä¿éšœã€‚" },
            { category: "è·ç½èªå®š", q: "æˆ‘åœ¨ç”°è£¡æšˆå€’ï¼Œç®—æ˜¯è·æ¥­ç½å®³å—ï¼Ÿ", a: "ç®—ï¼ä½†è¦æœ‰è­‰æ“šã€‚å°±é†«æ™‚ä¸€å®šè¦è·Ÿé†«ç”Ÿèªªã€Œæˆ‘æ˜¯åœ¨å¹¾é»å¹¾åˆ†ã€åœ¨å“ªå€‹ç”°è£¡å·¥ä½œæ™‚ç™¼ç”Ÿç‹€æ³ã€ï¼Œä¸¦ä¸”è«‹é†«ç”Ÿé–‹ç«‹è¨ºæ–·è­‰æ˜ï¼Œè¨»æ˜ã€Œèˆ‡å·¥ä½œç›¸é—œã€ã€‚" }
        ];

        const forumPosts = [
            { id: 1, author: "æ–°æ‰‹é’è¾²_é˜¿è±ª", avatar: "è±ª", title: "æ€¥ï¼è«‹å•æ°‘é›„å“ªè£¡æœ‰ä¿®å‰²è‰æ©Ÿçš„å¸«å‚…ï¼Ÿ", tag: "ç¶­ä¿®äº’åŠ©", content: "æˆ‘çš„èƒŒè² å¼å‰²è‰æ©Ÿçªç„¶ç™¼ä¸å‹•ï¼Œç«æ˜Ÿå¡æ›éäº†ä¹Ÿæ²’ç”¨ï¼Œæ€¥è‘—è¦é™¤è‰ï¼Œæ±‚æ¨è–¦ï¼" },
            { id: 2, author: "æ—ºä¾†ä¼¯", avatar: "æ—º", title: "æœ€è¿‘é³³æ¢¨åƒ¹æ ¼æ³¢å‹•å¤§ï¼Œå¤§å®¶æœ‰ä¿æ”¶å…¥ä¿éšªå—ï¼Ÿ", tag: "ç¶“æ¿Ÿè¨è«–", content: "è½èªªé‚£å€‹å¥§æ—åŒ¹å…‹å¹³å‡æ³•è¨ˆç®—çš„ä¿éšœåƒ¹æ ¼å¥½åƒä¸éŒ¯ï¼Œæœ‰äººæœ‰å¯¦éš›ç†è³ ç¶“é©—å—ï¼Ÿ" },
            { id: 3, author: "æº«å®¤å°é™³", avatar: "é™³", title: "[è´ˆé€] é€™è£¡æœ‰å¤šé¤˜çš„ 60% é®é™½ç¶²", tag: "ç‰©è³‡äº¤æµ", content: "æ›´æ›æ–°ç¶²å­ï¼ŒèˆŠçš„é‚„å ªç”¨ï¼Œç´„ 10 ç±³é•·ï¼Œæœ‰éœ€è¦çš„è¾²å‹å¯ä»¥è‡ªå–ï¼Œåœ¨ä¸‰èˆˆæ‘é™„è¿‘ã€‚" }
        ];

        const exerciseData = [
            { title: "è²“ç‰›å¼ (æ•‘æ•‘ä½ çš„è…°)", target: "é•·æ™‚é–“å½è…°æ‹”è‰çš„äºº", steps: ["æ‰‹æ‰¶ç”°åŸ‚ï¼Œèº«é«”å¾®å½", "å¸æ°£æ™‚æŠ¬é ­æŒºèƒ¸ (åƒç‰›)", "åæ°£æ™‚ä½é ­çœ‹è‚šè‡ (åƒè²“)", "é‡è¤‡ 10 æ¬¡"] },
            { title: "æŠ±è†ä¼¸å±• (æ”¾é¬†ä¸‹èƒŒ)", target: "æ¬é‡ç‰©è…°ç— çš„äºº", steps: ["å¹³èººä¸‹ä¾†", "é›™æ‰‹æŠ±è†å¾€èƒ¸å£æ‹‰", "åœç•™ 30 ç§’", "æ„Ÿè¦ºä¸‹èƒŒæ”¾é¬†"] },
            { title: "æ¯›å·¾è½‰è‚© (æ”¾é¬†è‚©è†€)", target: "å™´è—¥ã€æ‰‹èˆ‰é«˜çš„äºº", steps: ["æ‹¿æ¯›å·¾å…©ç«¯ä¼¸ç›´", "æ…¢æ…¢å¾€ä¸Šèˆ‰é«˜", "æ„Ÿè¦ºèƒ¸å£æ‹‰é–‹", "ç¶­æŒ 10 ç§’"] }
        ];

        // --- 3. [è£œå›] UI æ¨¡çµ„ (ä¹‹å‰æ¼æ‰é€™äº›ï¼Œå°è‡´ SOSButton is not defined) ---

        const Badge = ({ children, color = "green" }) => {
            const colors = {
                green: "bg-emerald-100 text-emerald-700",
                blue: "bg-blue-100 text-blue-700",
                purple: "bg-purple-100 text-purple-700",
                red: "bg-red-100 text-red-700",
                orange: "bg-orange-100 text-orange-700",
                gray: "bg-gray-100 text-gray-700",
                white: "bg-white/90 text-slate-800"
            };
            return <span className={`text-xs font-bold px-2.5 py-0.5 rounded-full ${colors[color] || colors.gray}`}>{children}</span>;
        };

        // --- è«‹è£œä¸Šé€™æ®µ SOSButton å…ƒä»¶ ---
        const SOSButton = ({ onClick, label }) => (
            <button 
                onClick={onClick}
                className="fixed bottom-6 right-6 z-50 bg-red-600 hover:bg-red-700 text-white p-4 rounded-full shadow-2xl flex items-center gap-2 transition-transform hover:scale-105 active:scale-95 border-4 border-white"
                title="Emergency / Darurat"
            >
                <AlertTriangle size={24}/>
                <span className="font-bold pr-1">{label}</span>
            </button>
        );

        const SectionHeader = ({ icon: Icon, title, subtitle }) => (
            <div className="mb-10 text-center animate-fade-in">
                <div className="inline-flex p-3 bg-emerald-100 rounded-xl mb-4">
                    <Icon className="w-8 h-8 text-emerald-700" />
                </div>
                <h2 className="text-3xl font-extrabold text-slate-800 mb-2">{title}</h2>
                <p className="text-slate-500 text-lg max-w-2xl mx-auto">{subtitle}</p>
            </div>
        );

        const ActionButton = ({ children, onClick, variant = "primary", className = "" }) => {
            const variants = {
                primary: "bg-emerald-600 text-white hover:bg-emerald-700 shadow-md",
                secondary: "bg-white text-slate-700 border border-slate-200 hover:bg-slate-50 shadow-sm",
                outline: "border-2 border-emerald-600 text-emerald-600 hover:bg-emerald-50"
            };
            return (
                <button className={`px-6 py-3 rounded-xl font-bold transition-all transform active:scale-95 flex items-center justify-center gap-2 ${variants[variant]} ${className}`} onClick={onClick}>
                    {children}
                </button>
            );
        };

        const EmergencyCard = ({ data, type, lang }) => {
            const isHeat = type === 'heat';
            const theme = isHeat ? { bg: 'bg-orange-50', border: 'border-orange-500', text: 'text-orange-600', sub: 'text-orange-800' } : { bg: 'bg-red-50', border: 'border-red-600', text: 'text-red-600', sub: 'text-red-800' };
            
            const title = isHeat ? lang.redCard.heatTitle : lang.redCard.pestTitle;
            const subtitle = isHeat ? lang.redCard.heatSub : lang.redCard.pestSub;

            return (
                <div className={`rounded-2xl bg-white border-l-8 ${theme.border} shadow-lg overflow-hidden`}>
                    <div className={`${theme.bg} p-6 border-b border-white/50 flex justify-between items-start`}>
                        <div>
                            <div className={`flex items-center gap-2 mb-1 font-bold ${theme.text} uppercase text-sm tracking-wider`}>
                                <AlertTriangle size={18}/> {data.level}
                            </div>
                            <h3 className="text-2xl font-extrabold text-slate-800">{title}</h3>
                            <p className={`${theme.sub} mt-1 font-medium`}>{subtitle}</p>
                        </div>
                        <Phone className={`${theme.text} opacity-20`} size={40} />
                    </div>
                    
                    <div className="p-6 grid md:grid-cols-2 gap-8">
                        <div>
                            <h4 className="font-bold text-slate-700 mb-4 flex items-center gap-2">
                                <Activity size={18} className="text-slate-400"/> å±éšªå¾µå…† (Symptoms)
                            </h4>
                            <ul className="space-y-3">
                                {data.symptoms.map((sym, i) => (
                                    <li key={i} className="flex items-center gap-3 bg-slate-50 p-3 rounded-xl border border-slate-100">
                                        <span className="text-2xl">{sym.icon}</span>
                                        <span className="font-bold text-slate-700">{sym.text}</span>
                                    </li>
                                ))}
                            </ul>
                        </div>

                        <div>
                            <h4 className="font-bold text-slate-700 mb-4 flex items-center gap-2">
                                <Shield size={18} className="text-slate-400"/> é¦¬ä¸Šé€™æ¨£åšï¼(Action)
                            </h4>
                            <div className="grid grid-cols-2 gap-3">
                                {data.actions.map((act, i) => (
                                    <div key={i} className={`${theme.bg} p-3 rounded-xl flex flex-col items-center text-center border border-white/50`}>
                                        <div className={`mb-2 p-2 bg-white rounded-full ${theme.text} shadow-sm`}>{act.icon}</div>
                                        <span className="font-bold text-slate-900 block mb-1">{act.step}</span>
                                        <span className="text-xs text-slate-600 leading-tight">{act.desc}</span>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const Accordion = ({ category, question, answer }) => {
            const [isOpen, setIsOpen] = useState(false);
            return (
                <div className="border border-slate-100 bg-white rounded-xl mb-3 overflow-hidden shadow-sm hover:shadow-md transition-shadow">
                    <button 
                        className="w-full py-4 px-6 flex justify-between items-center text-left focus:outline-none hover:bg-slate-50"
                        onClick={() => setIsOpen(!isOpen)}
                    >
                        <div>
                            <Badge color="blue">{category}</Badge>
                            <div className="font-bold text-lg text-slate-800 mt-2">{question}</div>
                        </div>
                        {isOpen ? <ChevronUp className="text-emerald-600" /> : <ChevronDown className="text-slate-400" />}
                    </button>
                    {isOpen && (
                        <div className="px-6 pb-6 text-slate-600 leading-relaxed border-t border-slate-50 pt-4 bg-slate-50/50">
                            {answer}
                        </div>
                    )}
                </div>
            );
        };

        // --- 4. é€€ä¼‘è©¦ç®—æ©Ÿèˆ‡è¼”åŠ©å…ƒä»¶ ---

        const InputGroup = ({ label, name, value, onChange, color = "emerald" }) => (
            <div>
                <label className={`label-text text-${color}-700`}>{label}</label>
                <input type="number" name={name} value={value} onChange={onChange} className={`input-field focus:ring-${color}-500 focus:border-${color}-500`} />
            </div>
        );

        const ResultCard = ({ title, icon, total, children, isWinner, colorClass, viewMode }) => (
            <div className={`bg-white p-6 rounded-xl border shadow-sm hover:shadow-md transition-all relative overflow-hidden group ${colorClass}`}>
                <div className="absolute top-0 right-0 p-6 opacity-5 group-hover:opacity-10 transition-opacity transform scale-150 origin-top-right">{icon}</div>
                <div className="flex justify-between items-start mb-2 relative z-10">
                    <h4 className="text-slate-500 text-sm font-bold flex items-center gap-2">{icon} {title}</h4>
                    {isWinner && <span className="bg-emerald-100 text-emerald-700 text-[10px] font-bold px-2 py-1 rounded-full">æ¨è–¦æ–¹æ¡ˆ</span>}
                </div>
                <div className="text-3xl font-extrabold text-slate-800 relative z-10">
                    ${Math.round(total).toLocaleString()} <span className="text-sm font-normal text-slate-400">/{viewMode === 'monthly' ? 'æœˆ' : 'ç¸½é¡'}</span>
                </div>
                <div className="relative z-10">{children}</div>
            </div>
        );

        const ResultRow = ({ label, value, color = "text-slate-700", bold = false, subLabel }) => (
            <div className="flex justify-between items-center text-sm">
                <span className="text-slate-500 flex items-center gap-1">
                    {label}
                    {subLabel && <span className="text-[10px] bg-slate-100 text-slate-500 px-1 rounded">{subLabel}</span>}
                </span>
                <span className={`font-medium ${color} ${bold ? 'font-bold' : ''}`}>${Math.round(value).toLocaleString()}</span>
            </div>
        );

        const DetailCard = ({ title, children }) => (
            <div className="bg-white p-4 rounded-lg border border-slate-200 shadow-sm h-full">
                <div className="font-bold text-slate-700 mb-3 border-b border-slate-100 pb-2">{title}</div>
                {children}
            </div>
        );

        const BreakdownCard = ({ title, monthly, totalFund, items, divisor, cappedInfo, info }) => (
            <div className="bg-white p-4 rounded-lg border border-slate-200 shadow-sm h-full">
                <div className="flex justify-between items-start mb-3 border-b border-slate-100 pb-2">
                    <div className="font-bold text-slate-700">{title}</div>
                    <div className="text-right">
                        <div className="text-lg font-bold text-slate-800">${Math.round(monthly).toLocaleString()}</div>
                        <div className="text-[10px] text-slate-400">/æœˆ</div>
                    </div>
                </div>
                <div className="space-y-2 text-xs mb-3">
                    {items.map((item, idx) => (
                        <div key={idx} className="flex justify-between">
                            <span className="text-slate-500">{item.label}</span>
                            <span className={`font-medium ${item.color}`}>${item.value.toLocaleString()}</span>
                        </div>
                    ))}
                    <div className="flex justify-between border-t border-slate-100 pt-2 mt-2">
                        <span className="font-bold text-slate-700">ç´¯ç©ç¸½é¡</span>
                        <span className="font-bold text-slate-800">${totalFund.toLocaleString()}</span>
                    </div>
                    {cappedInfo && <div className="mt-2 text-[10px] text-orange-600 bg-orange-50 p-1 rounded">{cappedInfo}</div>}
                    {info && <div className="mt-2 text-[10px] text-blue-600 bg-blue-50 p-1 rounded">{info}</div>}
                </div>
                <div className="bg-slate-50 p-2 rounded text-[10px] text-slate-400 text-center">ç¸½é¡ Ã· {divisor} å€‹æœˆ = æœˆé ˜é‡‘é¡</div>
            </div>
        );

        const CalculatorPage = () => {
             const CONSTANTS = {
                BASIC_WAGE_2025: 28590, OLD_FARMER_ALLOWANCE: 8110, LABOR_INS_MAX: 45800, LABOR_PENSION_MAX: 150000,
                LABOR_INS_RATE: 0.0155, LIFE_EXPECTANCY: 20, OLD_FARMER_AGE_LIMIT: 65, OLD_FARMER_YEARS_LIMIT: 15, NORMAL_RETIRE_AGE: 65,
            };

            const LEGAL_REFS = [
                { category: "å‹å·¥ä¿éšª (å¹´é‡‘ vs ä¸€æ¬¡é ˜)", icon: <Briefcase className="w-4 h-4 text-blue-600" />, items: [
                    { title: "è€å¹´å¹´é‡‘çµ¦ä»˜ (æœˆé ˜)", desc: "ä¾ã€Šå‹å·¥ä¿éšªæ¢ä¾‹ã€‹ç¬¬58-1æ¢ï¼Œæ¡ç¬¬äºŒå¼ï¼šå¹³å‡æœˆæŠ•ä¿è–ªè³‡ Ã— å¹´è³‡ Ã— 1.55%ã€‚", link: "https://laws.mol.gov.tw/FLAW/FLAWDOC01.aspx?id=FL014930" },
                    { title: "ä¸€æ¬¡è«‹é ˜è€å¹´çµ¦ä»˜ (èˆŠåˆ¶ç®—æ³•)", desc: "ä¾ç¬¬59æ¢ï¼šä¿éšªå¹´è³‡åˆè¨ˆæ¯æ»¿1å¹´ï¼ŒæŒ‰å¹³å‡æœˆæŠ•ä¿è–ªè³‡ç™¼çµ¦1å€‹æœˆï¼›è¶…é15å¹´è€…ï¼Œè¶…ééƒ¨åˆ†æ¯æ»¿1å¹´ç™¼çµ¦2å€‹æœˆï¼Œæœ€é«˜ä»¥45å€‹æœˆç‚ºé™ã€‚", link: "https://laws.mol.gov.tw/FLAW/FLAWDOC01.aspx?id=FL014930" },
                    { title: "å±•å»¶èˆ‡æ¸›çµ¦ (ææ—©/å»¶å¾Œ)", desc: "ä¾ç¬¬58-2æ¢ï¼šæ¯å»¶å¾Œ/æå‰1å¹´ï¼Œå¢çµ¦/æ¸›çµ¦4% (æœ€å¤š20%)ã€‚", link: "https://laws.mol.gov.tw/FLAW/FLAWDOC01.aspx?id=FL014930" }
                ]},
                { category: "å‹å·¥é€€ä¼‘é‡‘ (å€‹äººå°ˆæˆ¶)", icon: <PiggyBank className="w-4 h-4 text-purple-600" />, items: [
                    { title: "è«‹é ˜æ–¹å¼ (æœˆé ˜/ä¸€æ¬¡é ˜)", desc: "ä¾ã€Šå‹å·¥é€€ä¼‘é‡‘æ¢ä¾‹ã€‹ç¬¬24æ¢ï¼šå¹´è³‡æ»¿15å¹´ä»¥ä¸Šè€…ï¼Œå¾—è«‹é ˜æœˆé€€ä¼‘é‡‘ï¼›æœªæ»¿15å¹´è€…ï¼Œæ‡‰è«‹é ˜ä¸€æ¬¡é€€ä¼‘é‡‘ã€‚", link: "https://laws.mol.gov.tw/FLAW/FLAWDOC01.aspx?id=FL028091" }
                ]},
                { category: "è¾²æ°‘ç¦åˆ©èˆ‡å„²é‡‘", icon: <Sprout className="w-4 h-4 text-emerald-600" />, items: [
                    { title: "è¾²æ°‘é€€ä¼‘å„²é‡‘ (æœˆé ˜)", desc: "ä¾ã€Šè¾²æ°‘é€€ä¼‘å„²é‡‘æ¢ä¾‹ã€‹ç¬¬15æ¢ï¼šè¨ˆç®—æ–¹å¼ç‚ºå°ˆæˆ¶æœ¬é‡‘åŠç´¯ç©æ”¶ç›Šï¼Œä¾æ“šå¹´é‡‘ç”Ÿå‘½è¡¨è¨ˆç®—æœˆç™¼çµ¦é‡‘é¡ã€‚", link: "https://laws.mol.gov.tw/FLAW/FLAWDOC01.aspx?id=FL092049" }
                ]}
            ];

            const [inputs, setInputs] = useState({ currentAge: 35, laborStartAge: 25, laborRetireAge: 65, switchAge: 45, farmerRetireAge: 65, currentSalary: 55000, laborSelfRate: 0, farmerRate: 10, roiEstimate: 3, salaryGrowth: 2 });
            const [results, setResults] = useState(null);
            const [showDetails, setShowDetails] = useState(false);
            const [showLaws, setShowLaws] = useState(false);
            const [viewMode, setViewMode] = useState('monthly');
            const [validationErrors, setValidationErrors] = useState([]);

            const getNum = (val) => val === '' || val === undefined || val === null ? 0 : Number(val);

            const calculateRetirement = () => {
                const currentAge = getNum(inputs.currentAge);
                const laborRetireAge = getNum(inputs.laborRetireAge);
                const farmerRetireAge = getNum(inputs.farmerRetireAge);
                const switchAge = getNum(inputs.switchAge);
                const currentSalary = getNum(inputs.currentSalary);
                const laborStartAge = getNum(inputs.laborStartAge);
                const laborSelfRate = getNum(inputs.laborSelfRate);
                const farmerRate = getNum(inputs.farmerRate);
                const roiEstimate = getNum(inputs.roiEstimate);
                const salaryGrowth = getNum(inputs.salaryGrowth);
                
                const roi = roiEstimate / 100;
                const growth = salaryGrowth / 100;

                const errors = [];
                if (laborStartAge >= currentAge) errors.push("ã€Œé–‹å§‹å·¥ä½œå¹´é½¡ã€å¿…é ˆå°æ–¼ã€Œç›®å‰å¹´é½¡ã€");
                if (switchAge <= currentAge) errors.push("ã€Œè½‰è·å¹´é½¡ã€å¿…é ˆå¤§æ–¼ã€Œç›®å‰å¹´é½¡ã€(è‹¥å·²è½‰è·ï¼Œè«‹å°‡è½‰è·å¹´é½¡è¨­ç‚ºç›®å‰å¹´é½¡)");
                if (switchAge < laborStartAge) errors.push("ã€Œè½‰è·å¹´é½¡ã€ä¸èƒ½æ—©æ–¼ã€Œé–‹å§‹å·¥ä½œå¹´é½¡ã€");
                if (laborRetireAge <= currentAge) errors.push("å‹å·¥ã€Œé è¨ˆé€€ä¼‘å¹´é½¡ã€å¿…é ˆå¤§æ–¼ã€Œç›®å‰å¹´é½¡ã€");
                if (farmerRetireAge <= switchAge) errors.push("è¾²æ°‘ã€Œé è¨ˆé€€ä¼‘å¹´é½¡ã€å¿…é ˆå¤§æ–¼ã€Œè½‰è·å¹´é½¡ã€");
                if (laborRetireAge < 60) errors.push("å‹ä¿å¹´é‡‘æ³•å®šè«‹é ˜å¹´é½¡æœ€ä½ç‚º 60 æ­² (æ¸›çµ¦ 20%)");
                
                setValidationErrors(errors);
                if (errors.length > 0) { setResults(null); return; }

                const monthsToDistribute = CONSTANTS.LIFE_EXPECTANCY * 12;

                // A. å‹å·¥è·¯å¾‘
                let laborPath = { laborInsAnnuity: 0, laborPensionMonthly_Emp: 0, laborPensionMonthly_Self: 0, totalMonthly: 0, totalAsset_LaborIns: 0, totalAsset_LaborPension_Emp: 0, totalAsset_LaborPension_Self: 0, lumpSum_LaborIns: 0, details: {}, messages: [] };
                const yearsToLaborRetire = Math.max(0, laborRetireAge - currentAge);
                const totalLaborYears = laborRetireAge - laborStartAge;
                
                let projectedFinalSalary = currentSalary * Math.pow(1 + growth, yearsToLaborRetire);
                let laborInsSalary = Math.min(projectedFinalSalary, CONSTANTS.LABOR_INS_MAX);
                if (currentSalary >= CONSTANTS.LABOR_INS_MAX) laborInsSalary = CONSTANTS.LABOR_INS_MAX;

                let laborInsRateAdjustment = 1;
                let rateAdjText = "æ¨™æº–";
                const ageDiff = laborRetireAge - CONSTANTS.NORMAL_RETIRE_AGE;
                if (ageDiff < 0) { laborInsRateAdjustment = 1 - (Math.min(Math.abs(ageDiff), 5) * 0.04); rateAdjText = `ææ—© ${Math.min(Math.abs(ageDiff), 5)} å¹´ï¼Œæ¸›çµ¦`; } 
                else if (ageDiff > 0) { laborInsRateAdjustment = 1 + (Math.min(ageDiff, 5) * 0.04); rateAdjText = `å»¶å¾Œ ${Math.min(ageDiff, 5)} å¹´ï¼Œå¢çµ¦`; }

                laborPath.laborInsAnnuity = laborInsSalary * totalLaborYears * CONSTANTS.LABOR_INS_RATE * laborInsRateAdjustment;
                laborPath.totalAsset_LaborIns = laborPath.laborInsAnnuity * monthsToDistribute;

                let lumpSumUnits = totalLaborYears <= 15 ? totalLaborYears : 15 + (totalLaborYears - 15) * 2;
                if (lumpSumUnits > 45) lumpSumUnits = 45;
                laborPath.lumpSum_LaborIns = laborInsSalary * lumpSumUnits;

                laborPath.details.laborIns = { baseCalc: `$${Math.round(laborInsSalary).toLocaleString()} Ã— ${totalLaborYears}å¹´ Ã— 1.55%`, adjustment: rateAdjText, cappedInfo: currentSalary > CONSTANTS.LABOR_INS_MAX ? "å·²é”æŠ•ä¿ä¸Šé™" : "" };

                let lpAcc_Emp = 0, lpAcc_Self = 0, lpPrincipal_Emp = 0, lpPrincipal_Self = 0, currentSalarySim = currentSalary;
                for (let i = 0; i < yearsToLaborRetire; i++) {
                    let pensionSalary = Math.min(currentSalarySim, CONSTANTS.LABOR_PENSION_MAX);
                    lpPrincipal_Emp += pensionSalary * 0.06 * 12; lpAcc_Emp = (lpAcc_Emp + pensionSalary * 0.06 * 12) * (1 + roi);
                    lpPrincipal_Self += pensionSalary * (laborSelfRate / 100) * 12; lpAcc_Self = (lpAcc_Self + pensionSalary * (laborSelfRate / 100) * 12) * (1 + roi);
                    currentSalarySim *= (1 + growth);
                }
                laborPath.laborPensionMonthly_Emp = lpAcc_Emp / monthsToDistribute;
                laborPath.laborPensionMonthly_Self = lpAcc_Self / monthsToDistribute;
                laborPath.totalAsset_LaborPension_Emp = lpAcc_Emp; laborPath.totalAsset_LaborPension_Self = lpAcc_Self;
                laborPath.totalMonthly = laborPath.laborInsAnnuity + laborPath.laborPensionMonthly_Emp + laborPath.laborPensionMonthly_Self;
                laborPath.details.laborPension = { emp: { principal: lpPrincipal_Emp, total: lpAcc_Emp }, self: { principal: lpPrincipal_Self, total: lpAcc_Self }, monthlyDivisor: monthsToDistribute };

                // B. è¾²æ°‘è·¯å¾‘
                let farmerPath = { baseLayer: 0, baseLayerName: '', laborPensionMonthly_Emp: 0, laborPensionMonthly_Self: 0, farmerPensionMonthly: 0, totalMonthly: 0, totalAsset_BaseLayer: 0, totalAsset_LaborPension_Emp: 0, totalAsset_LaborPension_Self: 0, totalAsset_FarmerPension: 0, lumpSum_LaborIns: 0, details: {}, messages: [] };
                const yearsUntilSwitch = Math.max(0, switchAge - currentAge);
                const yearsAsFarmer = Math.max(0, farmerRetireAge - switchAge);
                const laborYearsAtSwitch = switchAge - laborStartAge;
                const yearsToCompoundOldLP = Math.max(0, farmerRetireAge - switchAge);

                let oldLpAcc_Emp = 0, oldLpAcc_Self = 0, oldLpPrin_Emp = 0, oldLpPrin_Self = 0, tempSalary = currentSalary;
                for (let i = 0; i < yearsUntilSwitch; i++) {
                    let pensionSalary = Math.min(tempSalary, CONSTANTS.LABOR_PENSION_MAX);
                    oldLpPrin_Emp += pensionSalary * 0.06 * 12; oldLpAcc_Emp = (oldLpAcc_Emp + pensionSalary * 0.06 * 12) * (1 + roi);
                    oldLpPrin_Self += pensionSalary * (laborSelfRate / 100) * 12; oldLpAcc_Self = (oldLpAcc_Self + pensionSalary * (laborSelfRate / 100) * 12) * (1 + roi);
                    tempSalary *= (1 + growth);
                }
                oldLpAcc_Emp *= Math.pow(1 + roi, yearsToCompoundOldLP); oldLpAcc_Self *= Math.pow(1 + roi, yearsToCompoundOldLP);
                farmerPath.laborPensionMonthly_Emp = oldLpAcc_Emp / monthsToDistribute;
                farmerPath.laborPensionMonthly_Self = oldLpAcc_Self / monthsToDistribute;
                farmerPath.totalAsset_LaborPension_Emp = oldLpAcc_Emp; farmerPath.totalAsset_LaborPension_Self = oldLpAcc_Self;

                let farmerPensionAccumulated = 0, farmerPrincipalUser = 0, farmerPrincipalGov = 0, basicWageSim = CONSTANTS.BASIC_WAGE_2025;
                for (let i = 0; i < yearsAsFarmer; i++) {
                    const monthlyContributionUser = basicWageSim * (farmerRate / 100);
                    farmerPrincipalUser += monthlyContributionUser * 12; farmerPrincipalGov += monthlyContributionUser * 12;
                    farmerPensionAccumulated = (farmerPensionAccumulated + monthlyContributionUser * 24) * (1 + roi);
                    basicWageSim *= (1 + growth);
                }
                let yearsWaiting = 0;
                if (farmerRetireAge < 65) { yearsWaiting = 65 - farmerRetireAge; farmerPensionAccumulated *= Math.pow(1 + roi, yearsWaiting); farmerPath.messages.push(`ã€è¾²é€€è¦å®šã€‘è¾²é€€å„²é‡‘éœ€æ»¿65æ­²æ‰å¯è«‹é ˜ï¼Œå·²ç‚ºæ‚¨è¨ˆç®— ${yearsWaiting} å¹´è¤‡åˆ©æ»¾å­˜ã€‚`); }
                farmerPath.farmerPensionMonthly = farmerPensionAccumulated / monthsToDistribute;
                farmerPath.totalAsset_FarmerPension = farmerPensionAccumulated;
                farmerPath.details.farmerPension = { totalFund: Math.round(farmerPensionAccumulated), principalUser: Math.round(farmerPrincipalUser), principalGov: Math.round(farmerPrincipalGov), totalYears: yearsAsFarmer, monthlyDivisor: monthsToDistribute };

                let laborInsSalaryAtSwitch = Math.min(tempSalary, CONSTANTS.LABOR_INS_MAX);
                if (currentSalary >= CONSTANTS.LABOR_INS_MAX) laborInsSalaryAtSwitch = CONSTANTS.LABOR_INS_MAX;
                let switchLaborRateAdj = 1, switchLaborAdjText = "æ¨™æº–";
                const ageDiffSwitch = farmerRetireAge - CONSTANTS.NORMAL_RETIRE_AGE;
                if (ageDiffSwitch < 0) { switchLaborRateAdj = 1 - (Math.min(Math.abs(ageDiffSwitch), 5) * 0.04); switchLaborAdjText = `ææ—©æ¸›çµ¦`; }
                else if (ageDiffSwitch > 0) { switchLaborRateAdj = 1 + (Math.min(ageDiffSwitch, 5) * 0.04); switchLaborAdjText = `å»¶å¾Œå¢çµ¦`; }
                
                const laborAnnuityAtSwitch = laborYearsAtSwitch >= 15 ? laborInsSalaryAtSwitch * laborYearsAtSwitch * CONSTANTS.LABOR_INS_RATE * switchLaborRateAdj : 0;
                let lumpSumUnitsSwitch = laborYearsAtSwitch <= 15 ? laborYearsAtSwitch : 15 + (laborYearsAtSwitch - 15) * 2;
                if (lumpSumUnitsSwitch > 45) lumpSumUnitsSwitch = 45;
                farmerPath.lumpSum_LaborIns = laborInsSalaryAtSwitch * lumpSumUnitsSwitch;

                let finalOldFarmerAmount = 0, oldFarmerStatus = "ok";
                if (farmerRetireAge < CONSTANTS.OLD_FARMER_AGE_LIMIT) { finalOldFarmerAmount = 0; oldFarmerStatus = "age_issue"; farmerPath.messages.push(`ã€è€è¾²æ´¥è²¼ã€‘æœªæ»¿ 65 æ­²ç„¡æ³•è«‹é ˜ï¼Œæ•…è€è¾²æ´¥è²¼æš«ç‚º 0ã€‚`); }
                else if (yearsAsFarmer < CONSTANTS.OLD_FARMER_YEARS_LIMIT) { finalOldFarmerAmount = 0; oldFarmerStatus = "year_issue"; farmerPath.messages.push(`ã€è€è¾²æ´¥è²¼ã€‘è¾²å‹™å¹´è³‡æœªæ»¿ 15 å¹´ï¼Œç„¡æ³•è«‹é ˜å…¨é¡è€è¾²æ´¥è²¼(æˆ–åªèƒ½é ˜åŠé¡ï¼Œæ­¤è™•ä¿å®ˆä¼° 0)ã€‚`); }
                else finalOldFarmerAmount = CONSTANTS.OLD_FARMER_ALLOWANCE;

                if (laborAnnuityAtSwitch > finalOldFarmerAmount) {
                    farmerPath.baseLayer = laborAnnuityAtSwitch; farmerPath.baseLayerName = `å‹ä¿å¹´é‡‘ (ä¿ç•™å¹´è³‡)`; farmerPath.totalAsset_BaseLayer = laborAnnuityAtSwitch * monthsToDistribute;
                    farmerPath.details.baseLayer = { calc: `å‹ä¿ $${Math.round(laborAnnuityAtSwitch)} > è€è¾² $${finalOldFarmerAmount}`, note: laborInsSalaryAtSwitch === CONSTANTS.LABOR_INS_MAX ? "å‹ä¿æŠ•ä¿è–ªè³‡å·²é”ä¸Šé™" : "" };
                } else {
                    farmerPath.baseLayer = finalOldFarmerAmount; farmerPath.baseLayerName = "è€è¾²æ´¥è²¼"; farmerPath.totalAsset_BaseLayer = finalOldFarmerAmount * monthsToDistribute;
                    farmerPath.details.baseLayer = { calc: oldFarmerStatus === 'ok' ? `å›ºå®š $${CONSTANTS.OLD_FARMER_ALLOWANCE}` : `$0 (${oldFarmerStatus})`, note: "" };
                }
                farmerPath.totalMonthly = farmerPath.baseLayer + farmerPath.laborPensionMonthly_Emp + farmerPath.laborPensionMonthly_Self + farmerPath.farmerPensionMonthly;
                setResults({ laborPath, farmerPath });
            };

            useEffect(() => { calculateRetirement(); }, [inputs]);
            const handleInputChange = (e) => { const { name, value } = e.target; setInputs(prev => ({ ...prev, [name]: value === '' ? '' : value })); };
            const getChartData = () => {
                if (!results) return [];
                const r = results;
                if (viewMode === 'monthly') return [
                    { name: 'çºŒç•¶å‹å·¥', 'å‹ä¿å¹´é‡‘/è€è¾²æ´¥è²¼': Math.round(r.laborPath.laborInsAnnuity), 'å‹é€€(é›‡ä¸»)': Math.round(r.laborPath.laborPensionMonthly_Emp), 'å‹é€€(è‡ªæ)': Math.round(r.laborPath.laborPensionMonthly_Self), 'è¾²æ°‘å„²é‡‘': 0 },
                    { name: 'è½‰è·å‹™è¾²', 'å‹ä¿å¹´é‡‘/è€è¾²æ´¥è²¼': Math.round(r.farmerPath.baseLayer), 'å‹é€€(é›‡ä¸»)': Math.round(r.farmerPath.laborPensionMonthly_Emp), 'å‹é€€(è‡ªæ)': Math.round(r.farmerPath.laborPensionMonthly_Self), 'è¾²æ°‘å„²é‡‘': Math.round(r.farmerPath.farmerPensionMonthly) }
                ];
                else return [
                    { name: 'çºŒç•¶å‹å·¥ (ç¸½è³‡ç”¢)', 'å‹ä¿å¹´é‡‘/è€è¾²æ´¥è²¼': Math.round(r.laborPath.totalAsset_LaborIns), 'å‹é€€(é›‡ä¸»)': Math.round(r.laborPath.totalAsset_LaborPension_Emp), 'å‹é€€(è‡ªæ)': Math.round(r.laborPath.totalAsset_LaborPension_Self), 'è¾²æ°‘å„²é‡‘': 0 },
                    { name: 'è½‰è·å‹™è¾² (ç¸½è³‡ç”¢)', 'å‹ä¿å¹´é‡‘/è€è¾²æ´¥è²¼': Math.round(r.farmerPath.totalAsset_BaseLayer), 'å‹é€€(é›‡ä¸»)': Math.round(r.farmerPath.totalAsset_LaborPension_Emp), 'å‹é€€(è‡ªæ)': Math.round(r.farmerPath.totalAsset_LaborPension_Self), 'è¾²æ°‘å„²é‡‘': Math.round(r.farmerPath.totalAsset_FarmerPension) }
                ];
            };
            const chartData = getChartData();

            return (
                <div className="min-h-screen bg-gray-50 font-sans text-gray-800 pb-12 animate-fade-in">
                    <div className="bg-slate-900 text-white pb-12 pt-8 px-4 shadow-lg">
                        <div className="max-w-6xl mx-auto flex flex-col md:flex-row justify-between items-center">
                            <div>
                                <h1 className="text-3xl md:text-4xl font-extrabold flex items-center gap-3 tracking-tight">
                                    <Calculator className="w-10 h-10 text-emerald-400" />
                                    å‹è¾²è·æ¶¯è½‰æ› <span className="text-emerald-400">é€€ä¼‘é‡‘ç²¾ç®— 4.0</span>
                                </h1>
                                <p className="mt-3 text-slate-300 text-lg font-medium max-w-2xl">ä¸€æ¬¡é ˜ vs æœˆé ˜ã€ç¸½è³‡ç”¢é ä¼°ã€å‹é€€è‡ªæåˆ†æµ</p>
                            </div>
                        </div>
                    </div>
                    <div className="max-w-6xl mx-auto -mt-8 px-4">
                        {validationErrors.length > 0 && (
                            <div className="bg-white p-4 border-l-4 border-red-500 shadow-md rounded-r-lg mb-6 animate-pulse">
                                <h3 className="font-bold text-red-700 flex items-center gap-2 mb-2"><AlertTriangle className="w-5 h-5" /> åƒæ•¸æª¢æ ¸éŒ¯èª¤ï¼š</h3>
                                <ul className="list-disc list-inside text-sm text-red-600 space-y-1">{validationErrors.map((err, i) => <li key={i}>{err}</li>)}</ul>
                            </div>
                        )}
                        <div className="grid grid-cols-1 lg:grid-cols-12 gap-6">
                            <div className="lg:col-span-4 space-y-6">
                                <div className="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                                    <div className="bg-slate-50 px-5 py-3 border-b border-slate-200 flex items-center gap-2"><Settings className="w-4 h-4 text-slate-500" /><h3 className="font-bold text-slate-700">åŸºæœ¬è¨­å®š</h3></div>
                                    <div className="p-5 space-y-4">
                                        <div><label className="label-text flex justify-between"><span>é ä¼°å¹´åŒ–å ±é…¬ç‡ (ROI)</span><span className="text-indigo-600 font-bold">{inputs.roiEstimate}%</span></label><input type="range" name="roiEstimate" min="1" max="10" value={inputs.roiEstimate} onChange={handleInputChange} className="w-full h-2 bg-indigo-100 rounded-lg appearance-none cursor-pointer" /></div>
                                        <div><label className="label-text flex justify-between"><span>é ä¼°è–ªè³‡å¹´æˆé•·ç‡</span><span className="text-blue-600 font-bold">{inputs.salaryGrowth}%</span></label><input type="range" name="salaryGrowth" min="0" max="5" value={inputs.salaryGrowth} onChange={handleInputChange} className="w-full h-2 bg-blue-100 rounded-lg appearance-none cursor-pointer" /></div>
                                    </div>
                                </div>
                                <div className="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                                    <div className="bg-blue-50 px-5 py-3 border-b border-blue-100 flex items-center gap-2"><Briefcase className="w-4 h-4 text-blue-600" /><h3 className="font-bold text-blue-800">å‹å·¥éšæ®µåƒæ•¸</h3></div>
                                    <div className="p-5 space-y-4">
                                        <div className="grid grid-cols-2 gap-4"><InputGroup label="ç›®å‰å¹´é½¡" name="currentAge" value={inputs.currentAge} onChange={handleInputChange} /><InputGroup label="å¹¾æ­²é–‹å§‹å·¥ä½œï¼Ÿ" name="laborStartAge" value={inputs.laborStartAge} onChange={handleInputChange} /></div>
                                        <div><label className="label-text">ç›®å‰å¯¦éš›æœˆè–ª (å…ƒ)</label><input type="number" name="currentSalary" value={inputs.currentSalary} onChange={handleInputChange} className="input-field" /></div>
                                    </div>
                                </div>
                                <div className="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                                    <div className="bg-orange-50 px-5 py-3 border-b border-orange-100 flex items-center gap-2"><ArrowRightLeft className="w-4 h-4 text-orange-600" /><h3 className="font-bold text-orange-800">è·æ¶¯è½‰æ›é»</h3></div>
                                    <div className="p-5 space-y-4">
                                        <div className="bg-orange-50/50 p-3 rounded-lg border border-orange-200"><label className="label-text text-orange-900">é è¨ˆå¹¾æ­²è½‰è·å‹™è¾²ï¼Ÿ</label><input type="number" name="switchAge" value={inputs.switchAge} onChange={handleInputChange} className="input-field border-orange-300 focus:ring-orange-500" /></div>
                                        <div className="grid grid-cols-2 gap-4">
                                            <div><label className="label-text text-blue-700">è‹¥çºŒç•¶å‹å·¥<br/>å¹¾æ­²é€€ä¼‘ï¼Ÿ</label><input type="number" name="laborRetireAge" value={inputs.laborRetireAge} onChange={handleInputChange} className="input-field" /></div>
                                            <div><label className="label-text text-emerald-700">è‹¥è½‰è¾²æ°‘<br/>å¹¾æ­²é€€ä¼‘ï¼Ÿ</label><input type="number" name="farmerRetireAge" value={inputs.farmerRetireAge} onChange={handleInputChange} className="input-field" /></div>
                                        </div>
                                    </div>
                                </div>
                                <div className="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                                    <div className="bg-emerald-50 px-5 py-3 border-b border-emerald-100 flex items-center gap-2"><Sprout className="w-4 h-4 text-emerald-600" /><h3 className="font-bold text-emerald-800">ææ’¥ç‡è¨­å®š</h3></div>
                                    <div className="p-5 space-y-5">
                                        <div><label className="label-text mb-1 flex justify-between"><span>è¾²é€€æç¹³ç‡</span><span className="font-bold text-emerald-600 text-lg">{inputs.farmerRate}%</span></label><div className="flex gap-2">{[1, 5, 10].map(r => <button key={r} onClick={() => setInputs(p => ({ ...p, farmerRate: r }))} className={`flex-1 py-1 text-xs rounded border ${inputs.farmerRate === r ? 'bg-emerald-600 text-white border-emerald-600' : 'bg-white text-emerald-600 border-emerald-200'}`}>{r}%</button>)}</div></div>
                                        <div><label className="label-text mb-1 flex justify-between"><span>å‹é€€è‡ªæç‡</span><span className="font-bold text-purple-600 text-lg">{inputs.laborSelfRate}%</span></label><div className="flex gap-2">{[0, 3, 6].map(r => <button key={r} onClick={() => setInputs(p => ({ ...p, laborSelfRate: r }))} className={`flex-1 py-1 text-xs rounded border ${inputs.laborSelfRate === r ? 'bg-purple-600 text-white border-purple-600' : 'bg-white text-purple-600 border-purple-200'}`}>{r}%</button>)}</div></div>
                                    </div>
                                </div>
                            </div>
                            <div className="lg:col-span-8 space-y-6">
                                {results ? (
                                    <>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                            <ResultCard title="æ–¹æ¡ˆ Aï¼šçºŒç•¶å‹å·¥" icon={<Briefcase className="w-6 h-6 text-blue-600" />} total={viewMode === 'monthly' ? results.laborPath.totalMonthly : results.laborPath.totalAsset_LaborIns + results.laborPath.totalAsset_LaborPension_Emp + results.laborPath.totalAsset_LaborPension_Self} isWinner={results.laborPath.totalMonthly > results.farmerPath.totalMonthly} colorClass="border-blue-100" viewMode={viewMode}>
                                                <div className="space-y-3 mt-4">
                                                    <ResultRow label="å‹ä¿å¹´é‡‘" value={viewMode === 'monthly' ? results.laborPath.laborInsAnnuity : results.laborPath.totalAsset_LaborIns} />
                                                    <ResultRow label="å‹é€€ (é›‡ä¸»6%)" value={viewMode === 'monthly' ? results.laborPath.laborPensionMonthly_Emp : results.laborPath.totalAsset_LaborPension_Emp} />
                                                    <ResultRow label="å‹é€€ (è‡ªæéƒ¨åˆ†)" value={viewMode === 'monthly' ? results.laborPath.laborPensionMonthly_Self : results.laborPath.totalAsset_LaborPension_Self} />
                                                </div>
                                            </ResultCard>
                                            <ResultCard title="æ–¹æ¡ˆ Bï¼šè½‰è·å‹™è¾²" icon={<Sprout className="w-6 h-6 text-emerald-600" />} total={viewMode === 'monthly' ? results.farmerPath.totalMonthly : results.farmerPath.totalAsset_BaseLayer + results.farmerPath.totalAsset_LaborPension_Emp + results.farmerPath.totalAsset_LaborPension_Self + results.farmerPath.totalAsset_FarmerPension} isWinner={results.farmerPath.totalMonthly > results.laborPath.totalMonthly} colorClass="border-emerald-100" viewMode={viewMode}>
                                                <div className="space-y-3 mt-4">
                                                    <div className="flex justify-between items-center text-sm border-b border-dashed border-slate-200 pb-2"><span className="text-slate-500">{results.farmerPath.baseLayerName}</span><span className="font-bold text-slate-700">${Math.round(viewMode === 'monthly' ? results.farmerPath.baseLayer : results.farmerPath.totalAsset_BaseLayer).toLocaleString()}</span></div>
                                                    <ResultRow label="èˆŠå‹é€€æ»¾å­˜" value={viewMode === 'monthly' ? (results.farmerPath.laborPensionMonthly_Emp + results.farmerPath.laborPensionMonthly_Self) : (results.farmerPath.totalAsset_LaborPension_Emp + results.farmerPath.totalAsset_LaborPension_Self)} />
                                                    <ResultRow label="è¾²æ°‘é€€ä¼‘å„²é‡‘" value={viewMode === 'monthly' ? results.farmerPath.farmerPensionMonthly : results.farmerPath.totalAsset_FarmerPension} />
                                                </div>
                                            </ResultCard>
                                        </div>
                                        <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-200 relative">
                                            <div className="flex justify-between items-center mb-4"><h4 className="font-bold text-slate-700 flex items-center gap-2"><TrendingUp className="w-5 h-5 text-slate-500" /> é€€ä¼‘é‡‘çµæ§‹åˆ†æ</h4><div className="bg-slate-100 p-1 rounded-lg flex text-xs font-bold"><button onClick={() => setViewMode('monthly')} className={`px-3 py-1 rounded-md transition-all ${viewMode === 'monthly' ? 'bg-white shadow text-slate-800' : 'text-slate-500'}`}>æœˆé ˜æ¨¡å¼</button><button onClick={() => setViewMode('total')} className={`px-3 py-1 rounded-md transition-all ${viewMode === 'total' ? 'bg-white shadow text-slate-800' : 'text-slate-500'}`}>ç¸½è³‡ç”¢æ¨¡å¼</button></div></div>
                                            <div className="h-80 w-full">
                                                <ResponsiveContainer width="100%" height="100%">
                                                    <BarChart data={chartData} layout="vertical" margin={{ top: 5, right: 50, left: 40, bottom: 5 }}>
                                                        <CartesianGrid strokeDasharray="3 3" horizontal={true} vertical={false} />
                                                        <XAxis type="number" tickFormatter={(val) => `$${val/1000}k`} />
                                                        <YAxis dataKey="name" type="category" width={100} tick={{fontSize: 12}} />
                                                        <Tooltip formatter={(value) => `$${value.toLocaleString()}`} contentStyle={{borderRadius: '12px'}} />
                                                        <Legend iconType="circle" />
                                                        <Bar dataKey="å‹ä¿å¹´é‡‘/è€è¾²æ´¥è²¼" stackId="a" fill="#3b82f6" radius={[0, 0, 0, 0]} barSize={32} />
                                                        <Bar dataKey="å‹é€€(é›‡ä¸»)" stackId="a" fill="#93c5fd" radius={[0, 0, 0, 0]} barSize={32} />
                                                        <Bar dataKey="å‹é€€(è‡ªæ)" stackId="a" fill="#8b5cf6" radius={[0, 0, 0, 0]} barSize={32} />
                                                        <Bar dataKey="è¾²æ°‘å„²é‡‘" stackId="a" fill="#10b981" radius={[0, 4, 4, 0]} barSize={32} />
                                                    </BarChart>
                                                </ResponsiveContainer>
                                            </div>
                                        </div>
                                        <div className="bg-gradient-to-br from-slate-50 to-white p-6 rounded-xl shadow-sm border border-slate-200">
                                            <h4 className="font-bold text-slate-800 mb-4 flex items-center gap-2 text-lg"><Coins className="w-6 h-6 text-yellow-500" />å¦‚æœé¸æ“‡ã€Œä¸€æ¬¡é ˜ã€ (Lump Sum)</h4>
                                            <div className="grid md:grid-cols-2 gap-6">
                                                <div className="bg-white p-4 rounded-lg border border-slate-200 shadow-sm">
                                                    <div className="flex justify-between items-start mb-2"><div className="font-bold text-slate-700">å‹ä¿è€å¹´çµ¦ä»˜</div><span className="text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded">çºŒç•¶å‹å·¥æ™‚</span></div>
                                                    <div className="text-2xl font-bold text-slate-800 mb-1">${Math.round(results.laborPath.lumpSum_LaborIns).toLocaleString()}</div>
                                                    <div className="text-xs text-slate-500 mb-3">ä»¥èˆŠåˆ¶æœ€é«˜ 45/50 åŸºæ•¸ä¼°ç®—</div>
                                                </div>
                                                <div className="bg-white p-4 rounded-lg border border-slate-200 shadow-sm">
                                                    <div className="flex justify-between items-start mb-2"><div className="font-bold text-slate-700">å‹é€€å°ˆæˆ¶çµæ¸…</div><span className="text-xs bg-slate-100 text-slate-600 px-2 py-0.5 rounded">å…©è€…çš†åŒ</span></div>
                                                    <div className="text-2xl font-bold text-slate-800 mb-1">${Math.round(results.laborPath.totalAsset_LaborPension_Emp + results.laborPath.totalAsset_LaborPension_Self).toLocaleString()}</div>
                                                    <div className="text-xs text-slate-500 mb-3">å¸³æˆ¶å¯¦éš›ç´¯ç©æœ¬é‡‘åŠ åˆ©æ¯</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div className="bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden">
                                            <button onClick={() => setShowDetails(!showDetails)} className="w-full flex items-center justify-between p-5 bg-slate-50 hover:bg-slate-100 transition-colors"><span className="font-bold text-slate-700">æŸ¥çœ‹è©³ç´°è¨ˆç®—éç¨‹</span>{showDetails ? <ChevronUp className="w-5 h-5 text-slate-500" /> : <ChevronDown className="w-5 h-5 text-slate-500" />}</button>
                                            {showDetails && (
                                                <div className="p-6 space-y-8 text-sm">
                                                    <div><SectionHeader title="A. çºŒç•¶å‹å·¥è¨ˆç®—ç´°ç¯€" color="blue" /><div className="grid md:grid-cols-2 gap-6 mt-4"><DetailCard title="å‹ä¿å¹´é‡‘"><div className="space-y-2"><div className="flex justify-between"><span>è¨ˆç®—å¼</span><span>{results.laborPath.details.laborIns.baseCalc}</span></div><div className="flex justify-between text-slate-500"><span>å¢æ¸›çµ¦èª¿æ•´</span><span>{results.laborPath.details.laborIns.adjustment}</span></div>{results.laborPath.details.laborIns.cappedInfo && <div className="text-orange-600 bg-orange-50 p-1 rounded text-xs mt-2">{results.laborPath.details.laborIns.cappedInfo}</div>}</div></DetailCard><BreakdownCard title="å‹å·¥é€€ä¼‘é‡‘ (6%é›‡ä¸» + è‡ªæ)" monthly={results.laborPath.laborPensionMonthly_Emp + results.laborPath.laborPensionMonthly_Self} totalFund={Math.round(results.laborPath.details.laborPension.emp.total + results.laborPath.details.laborPension.self.total)} items={[{ label: 'é›‡ä¸»ææ’¥æœ¬é‡‘ (6%)', value: Math.round(results.laborPath.details.laborPension.emp.principal), color: 'text-slate-600' }, { label: 'è‡ªææœ¬é‡‘', value: Math.round(results.laborPath.details.laborPension.self.principal), color: 'text-slate-600' }]} divisor={results.laborPath.details.laborPension.monthlyDivisor} info="åŒ…å«é ä¼°æŠ•è³‡æ”¶ç›Š" /></div></div>
                                                    <div className="border-t border-slate-100"></div>
                                                    <div><SectionHeader title="B. è½‰è·å‹™è¾²è¨ˆç®—ç´°ç¯€" color="emerald" /><div className="grid md:grid-cols-2 gap-6 mt-4"><div className="bg-white p-4 rounded-lg border border-slate-200 shadow-sm h-full"><div className="font-bold text-slate-700 mb-3 border-b border-slate-100 pb-2">ç¬¬ä¸€å±¤ä¿éšœ (å‹ä¿/è€è¾²æ“‡å„ª)</div><div className="space-y-2"><div className="flex justify-between"><span>çµæœ</span><span className="font-bold text-emerald-600">{results.farmerPath.baseLayerName}</span></div><div className="flex justify-between text-slate-500"><span>åˆ¤å®š</span><span>{results.farmerPath.details.baseLayer.calc}</span></div>{results.farmerPath.details.baseLayer.note && <div className="text-xs bg-slate-50 p-2 rounded mt-2 text-slate-500">{results.farmerPath.details.baseLayer.note}</div>}</div></div><BreakdownCard title="è¾²æ°‘é€€ä¼‘å„²é‡‘" monthly={results.farmerPath.farmerPensionMonthly} totalFund={results.farmerPath.details.farmerPension.totalFund} items={[{ label: 'è¾²æ°‘è‡ªææœ¬é‡‘', value: results.farmerPath.details.farmerPension.principalUser, color: 'text-emerald-600' }, { label: 'æ”¿åºœæç¹³æœ¬é‡‘', value: results.farmerPath.details.farmerPension.principalGov, color: 'text-emerald-600' }]} divisor={results.farmerPath.details.farmerPension.monthlyDivisor} cappedInfo={`ç´¯ç© ${results.farmerPath.details.farmerPension.totalYears} å¹´`} /></div></div>
                                                </div>
                                            )}
                                        </div>
                                    </>
                                ) : (
                                    <div className="h-96 flex flex-col items-center justify-center text-slate-300 bg-slate-50 rounded-xl border border-dashed border-slate-200"><Calculator className="w-16 h-16 mb-4 text-slate-200" /><p>è«‹è¼¸å…¥å·¦å´åƒæ•¸ä»¥é€²è¡Œè©¦ç®—</p></div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- 5. é é¢çµ„ä»¶ (Pages) ---
        // é›–ç„¶æ˜¯ part2ï¼Œä½†å› ç‚ºæˆ‘å€‘å¾©ç”¨äº†ä¹‹å‰çš„çµ„ä»¶ï¼Œæ‰€ä»¥é€™è£¡ä¿ç•™é¦–é çš„çµæ§‹
        // ä½†æ˜¯æˆ‘å€‘å°‡é è¨­é é¢è¨­ç‚º 'calculator'ï¼Œè®“ç”¨æˆ¶ä¸€é€²ä¾†å°±çœ‹åˆ°è¨ˆç®—æ©Ÿ
        
        const HomePage = ({ setPage, lang, currentDate }) => (
          <div className="animate-fade-in pb-12">
            <div className="bg-emerald-900 text-white pt-24 pb-32 px-4 rounded-b-[2.5rem] shadow-xl relative overflow-hidden">
              <div className="max-w-7xl mx-auto relative z-10">
                <div className="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
                   <div>
                     <div className="inline-flex items-center gap-2 bg-emerald-800/50 backdrop-blur-md px-4 py-1.5 rounded-full text-emerald-100 text-sm font-medium border border-emerald-700/50 mb-4">
                       <MapPin size={14}/> å˜‰ç¾©ç¸£æ°‘é›„é„‰ | <Calendar size={14}/> {currentDate}
                     </div>
                     <h1 className="text-4xl md:text-6xl font-extrabold tracking-tight">
                       {lang.title}<span className="text-emerald-400">{lang.subtitle}</span>
                     </h1>
                   </div>
                   <div className="bg-white/10 backdrop-blur-md border border-white/10 rounded-2xl p-4 w-full md:w-auto flex items-center gap-4 text-left shadow-lg">
                     <div className="bg-orange-500 p-3 rounded-xl text-white shadow-lg animate-pulse"><Sun size={32} /></div>
                     <div><h3 className="font-bold text-white text-lg">{lang.todayRisk}ï¼š{lang.high}</h3><p className="text-emerald-100 text-sm opacity-80">11:00 - 14:00 Avoid outdoor work.</p></div>
                   </div>
                </div>
                <p className="text-lg md:text-xl text-emerald-100/80 max-w-2xl font-light mb-10">{lang.heroDesc}</p>
              </div>
            </div>
            <div className="max-w-7xl mx-auto px-4 -mt-20 relative z-20 mb-16">
              <div className="grid md:grid-cols-3 gap-6">
                {[
                  { title: lang.identity.new, icon: <Sprout size={32}/>, desc: "çœ‹æ¸…é¢¨éšªï¼ŒçœŸå¯¦è©•è«–æ­éœ²ã€‚", color: "from-blue-500 to-blue-600", page: "startFarming" },
                  { title: lang.identity.young, icon: <Tractor size={32}/>, desc: "æº«å®¤è·å®‰èˆ‡çœå·¥æ©Ÿå…·å°ç­–ã€‚", color: "from-emerald-500 to-emerald-600", page: "greenhouse" },
                  { title: lang.identity.senior, icon: <Heart size={32}/>, desc: "ç— ç—›æ”¹å–„èˆ‡è·ç½çµ¦ä»˜ç”³è«‹ã€‚", color: "from-orange-500 to-orange-600", page: "healthPromo" }
                ].map((item, i) => (
                  <div key={i} onClick={() => setPage(item.page)} className="bg-white rounded-2xl shadow-xl hover:shadow-2xl transition-all duration-300 hover:-translate-y-2 cursor-pointer p-8 group border border-slate-100 relative overflow-hidden">
                    <div className={`w-14 h-14 rounded-xl bg-gradient-to-br ${item.color} text-white flex items-center justify-center mb-6 shadow-md group-hover:scale-110 transition-transform`}>{item.icon}</div>
                    <h3 className="text-2xl font-bold text-slate-800 mb-3">{item.title}</h3>
                    <p className="text-slate-500 mb-6 leading-relaxed">{item.desc}</p>
                    <div className="flex items-center text-sm font-bold text-emerald-600 group-hover:text-emerald-700">{lang.identity.enter} <ArrowRight size={16} className="ml-2 group-hover:translate-x-1 transition-transform"/></div>
                  </div>
                ))}
              </div>
            </div>
            <div className="max-w-7xl mx-auto px-4 grid lg:grid-cols-2 gap-8 mb-12">
              <div className="bg-white rounded-3xl p-8 border border-slate-100 shadow-lg">
                 <div className="flex justify-between items-center mb-6 border-b border-slate-50 pb-4"><h3 className="text-2xl font-bold text-slate-800 flex items-center gap-3"><MessageCircle className="text-blue-500"/> {lang.section.forum}</h3><button onClick={() => setPage('forum')} className="text-sm font-bold text-slate-400 hover:text-slate-600 flex items-center gap-1">{lang.section.more} <ArrowRight size={14}/></button></div>
                 <div className="space-y-4">
                   {forumPosts.map((post) => (
                     <div key={post.id} className="flex gap-4 p-4 rounded-2xl bg-slate-50 hover:bg-blue-50/50 transition-colors cursor-pointer border border-transparent hover:border-blue-100 group" onClick={() => setPage('forum')}>
                       <div className="w-12 h-12 rounded-full bg-white border border-slate-100 flex items-center justify-center font-bold text-slate-500 flex-shrink-0 shadow-sm group-hover:text-blue-600 group-hover:border-blue-200">{post.avatar}</div>
                       <div className="flex-grow"><div className="flex justify-between items-start"><h4 className="font-bold text-slate-800 line-clamp-1 group-hover:text-blue-700">{post.title}</h4><span className="text-xs bg-white px-2 py-0.5 rounded-full text-slate-400 border border-slate-100">{post.tag}</span></div><p className="text-sm text-slate-500 line-clamp-2 mt-1">{post.content}</p></div>
                     </div>
                   ))}
                 </div>
              </div>
              <div className="bg-slate-900 rounded-3xl p-8 shadow-lg text-white relative overflow-hidden">
                 <div className="absolute top-0 right-0 w-64 h-64 bg-emerald-500 rounded-full blur-[80px] opacity-20 -mr-16 -mt-16 pointer-events-none"></div>
                 <div className="relative z-10">
                   <div className="flex justify-between items-center mb-6 border-b border-white/10 pb-4"><h3 className="text-2xl font-bold flex items-center gap-3"><PlayCircle className="text-emerald-400"/> {lang.section.video}</h3><button onClick={() => setPage('videos')} className="text-sm font-bold text-slate-400 hover:text-white flex items-center gap-1">{lang.section.more} <ArrowRight size={14}/></button></div>
                   <div className="bg-white/5 rounded-2xl p-4 mb-4 backdrop-blur-sm border border-white/10 cursor-pointer hover:bg-white/10 transition-colors group" onClick={() => setPage('videos')}>
                     <div className="flex gap-5">
                       <div className="w-32 h-24 bg-black rounded-xl flex items-center justify-center flex-shrink-0 relative overflow-hidden border border-white/10">
                         {videoData[0] && videoData[0].youtubeId ? ( <img src={`https://img.youtube.com/vi/${videoData[0].youtubeId}/mqdefault.jpg`} alt="thumbnail" className="w-full h-full object-cover opacity-80 group-hover:opacity-100 transition-opacity" /> ) : ( <div className="w-full h-full bg-slate-800" /> )}
                         <PlayCircle size={32} className="text-white absolute z-10 drop-shadow-md group-hover:scale-110 transition-transform"/>
                       </div>
                       <div className="flex flex-col justify-center"><div className="mb-2"><Badge color="white">{videoData[0]?.type || 'Video'}</Badge></div><h4 className="font-bold text-lg mb-1 group-hover:text-emerald-300 transition-colors line-clamp-1">{videoData[0]?.title}</h4><p className="text-xs text-slate-400 line-clamp-2">{videoData[0]?.desc}</p></div>
                     </div>
                   </div>
                   <div className="space-y-3">
                      {videoData.slice(1, 3).map((video) => (
                        <div key={video.id} className="flex items-center gap-4 p-3 rounded-xl hover:bg-white/5 cursor-pointer text-slate-300 hover:text-white transition-colors border border-transparent hover:border-white/5" onClick={() => setPage('videos')}>
                          <div className="w-10 h-10 rounded-lg bg-black/50 overflow-hidden flex-shrink-0 border border-white/10">
                             {video.youtubeId ? ( <img src={`https://img.youtube.com/vi/${video.youtubeId}/default.jpg`} className="w-full h-full object-cover" /> ) : ( <div className="flex items-center justify-center h-full"><PlayCircle size={16}/></div> )}
                          </div>
                          <span className="font-medium truncate flex-grow text-sm md:text-base">{video.title}</span><span className="text-xs opacity-50 whitespace-nowrap">{video.views}</span>
                        </div>
                      ))}
                   </div>
                 </div>
              </div>
            </div>
          </div>
        );
        
        const SafetyPage = ({ lang }) => ( <div className="max-w-4xl mx-auto px-4 py-12 animate-fade-in"><SectionHeader icon={Shield} title={lang.nav.safety} subtitle="SOS Guide / æ•‘å‘½æŒ‡å—"/><div className="space-y-12"><EmergencyCard data={safetyData.heat} type="heat" lang={lang} /><EmergencyCard data={safetyData.pesticide} type="pesticide" lang={lang} /></div></div> );
        
        const EconomicsPage = () => ( <div className="max-w-4xl mx-auto px-4 py-12 animate-fade-in"><SectionHeader icon={DollarSign} title="ä¿éšªèˆ‡ç¶“æ¿Ÿå®‰å…¨" subtitle="ææ‡‚æ¬Šç›Šï¼Œå¢åŠ ä½ çš„å‹™è¾²æ”¶å…¥"/><div className="space-y-4">{qaData.map((qa, i) => ( <Accordion key={i} category={qa.category} question={qa.q} answer={qa.a} /> ))}</div></div> );
        
        const StartFarmingPage = () => ( <div className="max-w-4xl mx-auto px-4 py-12 animate-fade-in"><SectionHeader icon={Sprout} title="å¾äº‹è¾²æ¥­ï¼šçœŸå¯¦é¢æ­éœ²" subtitle="å‰è¼©çš„çœŸå¿ƒè©±ï¼Œè½è½å†æ±ºå®š"/><div className="bg-white p-8 rounded-2xl shadow-lg border border-slate-100 text-center"><h3 className="text-2xl font-bold text-slate-800 mb-4">ğŸš§ å…§å®¹å»ºç½®ä¸­</h3><p className="text-slate-500">æˆ‘å€‘æ­£åœ¨æ¡è¨ª 10 ä½ä¸åŒä½œç‰©çš„è¾²å‹ï¼Œæ•´ç†ä»–å€‘çš„çœŸå¯¦ç¶“é©—èˆ‡æç›Šè¡¨ï¼Œæ•¬è«‹æœŸå¾…ï¼</p></div></div> );
        
        const GreenhousePage = () => ( <div className="max-w-4xl mx-auto px-4 py-12 animate-fade-in"><SectionHeader icon={Tractor} title="æº«å®¤èˆ‡çœå·¥æ©Ÿå…·" subtitle="è®“ç§‘æŠ€å¹«ä½ æµæ±—ï¼Œé é˜²è·æ¥­å‚·å®³"/><div className="bg-white p-8 rounded-2xl shadow-lg border border-slate-100 text-center"><h3 className="text-2xl font-bold text-slate-800 mb-4">ğŸš§ å…§å®¹å»ºç½®ä¸­</h3><p className="text-slate-500">æ­£åœ¨å½™æ•´é©åˆå°è¾²çš„çœå·¥æ©Ÿå…·æ¸…å–®èˆ‡è£œåŠ©è³‡è¨Šã€‚</p></div></div> );
        
        const HealthPromoPage = () => ( <div className="max-w-4xl mx-auto px-4 py-12 animate-fade-in"><SectionHeader icon={Activity} title="å¥åº·ä¿ƒé€²èˆ‡ä¼¸å±•" subtitle="æ¯å¤© 3 åˆ†é˜ï¼Œé é˜²è…°ç— èƒŒç—›"/><div className="grid md:grid-cols-2 gap-6">{exerciseData.map((ex, i) => ( <div key={i} className="bg-white p-6 rounded-2xl shadow-md border border-slate-100 hover:shadow-lg transition-all"><div className="flex items-center gap-3 mb-4"><span className="bg-emerald-100 text-emerald-700 font-bold w-8 h-8 rounded-full flex items-center justify-center">{i+1}</span><h3 className="font-bold text-lg text-slate-800">{ex.title}</h3></div><p className="text-sm text-slate-500 mb-4 bg-slate-50 p-2 rounded">é©åˆï¼š{ex.target}</p><ul className="space-y-2 text-slate-600 text-sm">{ex.steps.map((step, j) => ( <li key={j} className="flex items-start gap-2"><ArrowRight size={14} className="mt-1 text-emerald-400 flex-shrink-0"/> {step}</li> ))}</ul></div> ))}</div></div> );
        
        const ForumPage = () => ( <div className="max-w-4xl mx-auto px-4 py-12 animate-fade-in"><SectionHeader icon={MessageCircle} title="è¾²æ°‘äº¤æµåœ’åœ°" subtitle="äº’åŠ©åˆä½œï¼Œåšå½¼æ­¤çš„å¾Œç›¾"/><div className="space-y-4">{forumPosts.map((post) => ( <div key={post.id} className="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 hover:shadow-md transition-shadow"><div className="flex items-center gap-3 mb-3"><div className="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center font-bold text-slate-500">{post.avatar}</div><div><div className="font-bold text-slate-800">{post.author}</div><div className="text-xs text-slate-400">2å°æ™‚å‰</div></div><Badge>{post.tag}</Badge></div><h3 className="font-bold text-xl text-slate-800 mb-2">{post.title}</h3><p className="text-slate-600 mb-4">{post.content}</p><div className="flex gap-4 border-t border-slate-50 pt-4 text-slate-400 text-sm"><button className="flex items-center gap-1 hover:text-emerald-600"><ThumbsUp size={16}/> 12</button><button className="flex items-center gap-1 hover:text-blue-600"><MessageCircle size={16}/> 5</button><button className="flex items-center gap-1 hover:text-slate-600 ml-auto"><Share2 size={16}/> åˆ†äº«</button></div></div> ))}</div></div> );
        
        const VideosPage = () => ( <div className="max-w-6xl mx-auto px-4 py-12 animate-fade-in"><SectionHeader icon={PlayCircle} title="å½±éŸ³å­¸ç¿’å°ˆå€" subtitle="ç”¨çœ‹ç”¨è½éƒ½æ–¹ä¾¿ã€‚"/><div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">{videoData.map((video) => ( <div key={video.id} className="bg-white rounded-2xl shadow-lg overflow-hidden group cursor-pointer"><div className="aspect-video bg-slate-900 relative overflow-hidden">{video.youtubeId ? <img src={`https://img.youtube.com/vi/${video.youtubeId}/hqdefault.jpg`} className="w-full h-full object-cover opacity-90 group-hover:opacity-100 group-hover:scale-105 transition-all duration-500"/> : <div className={`w-full h-full ${video.coverColor}`}/>}<div className="absolute inset-0 flex items-center justify-center"><div className="w-14 h-14 bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center border border-white/30 group-hover:scale-110 transition-transform"><PlayCircle size={32} className="text-white"/></div></div><div className="absolute bottom-2 right-2 bg-black/60 text-white text-xs px-2 py-1 rounded backdrop-blur-sm">12:30</div></div><div className="p-5"><div className="flex justify-between items-start mb-2"><Badge>{video.type}</Badge><span className="text-xs text-slate-400">{video.date}</span></div><h3 className="font-bold text-lg text-slate-800 mb-2 line-clamp-2 group-hover:text-emerald-600 transition-colors">{video.title}</h3><p className="text-slate-500 text-sm line-clamp-2 mb-4">{video.desc}</p><div className="flex items-center gap-2 text-xs text-slate-400"><Users size={14}/> {video.views} views</div></div></div> ))}</div></div> );
        
        const ResourcesPage = () => ( <div className="max-w-4xl mx-auto px-4 py-12 animate-fade-in"><SectionHeader icon={Download} title="è³‡æºä¸‹è¼‰" subtitle="å¸¶å¾—èµ°çš„å·¥å…·åŒ…ã€‚"/><div className="grid md:grid-cols-2 gap-6">{['è·ç½çµ¦ä»˜ç”³è«‹æ›¸ç¯„æœ¬.pdf', 'æº«å®¤è¨­å‚™è£œåŠ©æ‡¶äººåŒ….pdf', 'è¾²æ°‘å¥åº·é«”æ“æµ·å ±.jpg'].map((file, i) => ( <div key={i} className="flex items-center justify-between p-4 bg-white rounded-xl border border-slate-200 shadow-sm hover:bg-slate-50"><div className="flex items-center gap-3"><div className="bg-slate-100 p-2 rounded-lg"><BookOpen className="text-slate-500" size={20}/></div><span className="font-bold text-slate-700">{file}</span></div><button className="text-emerald-600 hover:text-emerald-700 p-2"><Download size={20}/></button></div> ))}</div></div> );

        // --- 6. ä¸»ç¨‹å¼ (Main App) ---
        function App() {
            // è¨­å®šé è¨­é é¢ç‚º calculator
            const [page, setPage] = useState('calculator');
            const [menuOpen, setMenuOpen] = useState(false);
            const [scrolled, setScrolled] = useState(false);
            const [currentLang, setCurrentLang] = useState('zh');
            const [showLangMenu, setShowLangMenu] = useState(false);
            const t = translations[currentLang];
            const [currentDate, setCurrentDate] = useState('');

            useEffect(() => { window.scrollTo(0, 0); setMenuOpen(false); }, [page]);
            useEffect(() => {
                const handleScroll = () => setScrolled(window.scrollY > 20);
                window.addEventListener('scroll', handleScroll);
                const date = new Date();
                const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
                setCurrentDate(date.toLocaleDateString('zh-TW', options));
                return () => window.removeEventListener('scroll', handleScroll);
            }, []);

            const changeLang = (lang) => { setCurrentLang(lang); setShowLangMenu(false); };

            // å°è¦½åˆ—ï¼šç¶­æŒå…¨ç«™ä¸€è‡´
            const navItems = [
                { id: 'home', label: t.nav.home },
                { id: 'startFarming', label: t.nav.start },
                { id: 'greenhouse', label: t.nav.greenhouse },
                { id: 'safety', label: t.nav.safety },
                { id: 'healthPromo', label: t.nav.health },
                { id: 'economics', label: t.nav.insurance },
                { id: 'calculator', label: t.nav.calculator }, 
                { id: 'forum', label: t.nav.forum },
                { id: 'videos', label: t.nav.video },
                { id: 'resources', label: t.nav.resources },
            ];

            const renderPage = () => {
                switch (page) {
                    case 'home': return <HomePage setPage={setPage} lang={t} currentDate={currentDate} />;
                    case 'startFarming': return <StartFarmingPage />;
                    case 'greenhouse': return <GreenhousePage />;
                    case 'safety': return <SafetyPage lang={t} />;
                    case 'healthPromo': return <HealthPromoPage />;
                    case 'economics': return <EconomicsPage />;
                    case 'calculator': return <CalculatorPage />; 
                    case 'forum': return <ForumPage />;
                    case 'videos': return <VideosPage />;
                    case 'resources': return <ResourcesPage />;
                    default: return <HomePage setPage={setPage} lang={t} currentDate={currentDate} />;
                }
            };

            return (
                <div className="min-h-screen bg-slate-50 font-sans text-slate-800 selection:bg-emerald-200">
                    <nav className={`fixed top-0 w-full z-50 transition-all duration-300 ${scrolled ? 'bg-white/95 backdrop-blur-md shadow-md py-2' : 'bg-emerald-900 text-white py-3'}`}>
                        <div className="max-w-[1400px] mx-auto px-4">
                            <div className="flex justify-between items-center">
                                <div className="flex items-center cursor-pointer gap-2 shrink-0" onClick={() => setPage('home')}>
                                    <img src="Logo.PNG" alt="Logo" className="h-16 w-auto object-contain bg-white rounded-lg" />
                                    <span className={`font-extrabold text-xl tracking-tight hidden sm:block ${scrolled ? 'text-emerald-900' : 'text-white'}`}>{t.title}</span>
                                </div>
                                <div className="hidden lg:flex items-center gap-1 overflow-x-auto no-scrollbar mx-4">
                                    {navItems.map(item => (
                                        <button key={item.id} onClick={() => setPage(item.id)} className={`px-3 py-2 rounded-full text-sm font-bold whitespace-nowrap transition-all ${page === item.id ? (scrolled ? 'bg-emerald-100 text-emerald-800' : 'bg-white/20 text-white') : (scrolled ? 'text-slate-600 hover:bg-slate-100' : 'text-emerald-100 hover:bg-white/10')}`}>
                                            {item.label}
                                        </button>
                                    ))}
                                </div>
                                <div className="flex items-center gap-2">
                                    <div className="relative">
                                        <button onClick={() => setShowLangMenu(!showLangMenu)} className={`flex items-center gap-1 px-3 py-2 rounded-full font-bold text-xs transition-colors ${scrolled ? 'bg-slate-100 text-slate-700 hover:bg-slate-200' : 'bg-white/10 text-white hover:bg-white/20'}`}>
                                            <Globe size={14} /> {currentLang.toUpperCase()}
                                        </button>
                                        {showLangMenu && (<div className="absolute right-0 mt-2 w-32 bg-white rounded-xl shadow-xl border border-slate-100 overflow-hidden animate-fade-in text-slate-800"><button onClick={() => changeLang('zh')} className="w-full text-left px-4 py-2 hover:bg-slate-50 text-sm font-medium">ä¸­æ–‡</button><button onClick={() => changeLang('en')} className="w-full text-left px-4 py-2 hover:bg-slate-50 text-sm font-medium">English</button><button onClick={() => changeLang('id')} className="w-full text-left px-4 py-2 hover:bg-slate-50 text-sm font-medium">Bahasa</button></div>)}
                                    </div>
                                    <button onClick={() => setMenuOpen(!menuOpen)} className={`lg:hidden p-2 ${scrolled ? 'text-slate-800' : 'text-white'}`}>{menuOpen ? <X size={24}/> : <Menu size={24}/>}</button>
                                </div>
                            </div>
                        </div>
                        {menuOpen && (<div className="lg:hidden absolute top-full left-0 w-full bg-white border-t border-slate-100 shadow-xl animate-fade-in"><div className="p-4 space-y-2">{navItems.map(item => (<button key={item.id} onClick={() => setPage(item.id)} className={`block w-full text-left px-4 py-3 rounded-xl font-bold ${page === item.id ? 'bg-emerald-50 text-emerald-700' : 'text-slate-600'}`}>{item.label}</button>))}</div></div>)}
                    </nav>
                    <main className="min-h-screen pt-16">{renderPage()}</main>
                    <SOSButton onClick={() => setPage('safety')} label={t.nav.safety} />
                    <footer className="bg-slate-900 text-slate-400 py-16"><div className="max-w-6xl mx-auto px-4 grid md:grid-cols-4 gap-12 mb-12"><div className="col-span-1 md:col-span-2"><div className="flex items-center gap-3 mb-6"><img src="Logo.PNG" alt="Logo" className="h-12 w-auto bg-white rounded-lg" /><span className="text-2xl font-bold text-white">å°Šåš´è¾²æ¥­</span></div><p className="text-lg leading-relaxed mb-6">æˆ‘å€‘è‡´åŠ›æ–¼æ‰“é€ ä¸€å€‹è³‡è¨Šé€æ˜ã€è³‡æºå…±äº«çš„è¾²æ¥­æ”¯æŒé«”ç³»ï¼Œçµåˆé†«ç™‚å°ˆæ¥­ã€ç§‘æŠ€å·¥å…·èˆ‡ç¤¾æœƒä¿éšªï¼Œå®ˆè­·æ¯ä¸€ä½ç‚ºåœŸåœ°ä»˜å‡ºçš„è¾²æ°‘ã€‚</p><div className="flex gap-4"><a href="#" className="w-10 h-10 rounded-full bg-slate-800 flex items-center justify-center hover:bg-emerald-600 hover:text-white transition-colors"><Facebook size={20}/></a><a href="#" className="w-10 h-10 rounded-full bg-slate-800 flex items-center justify-center hover:bg-emerald-600 hover:text-white transition-colors"><Youtube size={20}/></a><a href="#" className="w-10 h-10 rounded-full bg-slate-800 flex items-center justify-center hover:bg-emerald-600 hover:text-white transition-colors"><Instagram size={20}/></a></div></div><div><h4 className="text-white font-bold text-lg mb-6">å¿«é€Ÿé€£çµ</h4><ul className="space-y-4"><li><a href="#" onClick={(e) => { e.preventDefault(); setPage('startFarming'); }} className="hover:text-emerald-400 transition-colors">æ–°æ‰‹å…¥é–€æŒ‡å—</a></li><li><a href="#" onClick={(e) => { e.preventDefault(); setPage('calculator'); }} className="hover:text-emerald-400 transition-colors">é€€ä¼‘é‡‘è©¦ç®—</a></li><li><a href="#" onClick={(e) => { e.preventDefault(); setPage('safety'); }} className="hover:text-emerald-400 transition-colors">æ€¥æ•‘ SOS</a></li><li><a href="#" onClick={(e) => { e.preventDefault(); setPage('resources'); }} className="hover:text-emerald-400 transition-colors">è³‡æºä¸‹è¼‰</a></li></ul></div><div><h4 className="text-white font-bold text-lg mb-6">è¯çµ¡æˆ‘å€‘</h4><ul className="space-y-4"><li className="flex items-start gap-3"><MapPin className="mt-1 flex-shrink-0 text-emerald-500"/><span className="leading-relaxed">621 å˜‰ç¾©ç¸£æ°‘é›„é„‰<br/>å¤§å­¸è·¯ä¸€æ®µ 168 è™Ÿ</span></li><li className="flex items-center gap-3"><Phone className="flex-shrink-0 text-emerald-500"/><span>05-272-0411</span></li><li className="flex items-center gap-3"><Mail className="flex-shrink-0 text-emerald-500"/><span>contact@dignified-agri.tw</span></li></ul></div></div><div className="max-w-6xl mx-auto px-4 pt-8 border-t border-slate-800 text-center text-sm"><p>&copy; 2024 Dignified Agriculture. All rights reserved. | <a href="#" className="hover:text-white">éš±ç§æ¬Šæ”¿ç­–</a> | <a href="#" className="hover:text-white">ä½¿ç”¨æ¢æ¬¾</a></p></div></footer>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
